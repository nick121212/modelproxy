{"version":3,"sources":["webpack://modelproxy/webpack/universalModuleDefinition","webpack://modelproxy/webpack/bootstrap","webpack://modelproxy/./src/index.ts","webpack://modelproxy/external {\"root\":\"modelproxy\",\"amd\":\"modelproxy\",\"commonjs2\":\"modelproxy\",\"commonjs\":\"modelproxy\"}","webpack://modelproxy/external {\"root\":\"fetch\",\"amd\":\"isomorphic-fetch\",\"commonjs2\":\"isomorphic-fetch\",\"commonjs\":\"isomorphic-fetch\"}","webpack://modelproxy/external {\"root\":\"URLSearchParams\",\"amd\":\"url-search-params\",\"commonjs2\":\"url-search-params\",\"commonjs\":\"url-search-params\"}"],"names":["root","factory","exports","module","require","define","amd","modelproxy","fetch","URLSearchParams","window","__WEBPACK_EXTERNAL_MODULE__1__","__WEBPACK_EXTERNAL_MODULE__2__","__WEBPACK_EXTERNAL_MODULE__3__","e","installedModules","__webpack_require__","moduleId","i","l","threw","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","default","object","property","prototype","hasOwnProperty","p","s","this","__extends","setPrototypeOf","__proto__","Array","constructor","__awaiter","Promise","a","next","u","throw","done","then","apply","__generator","label","sent","trys","ops","return","iterator","TypeError","pop","length","push","modelproxy_1","defaultHeaders","Accept","Content-Type","FetchEngine","_super","init","use","ctx","formData","bodyParams","_a","executeInfo","_b","instance","headers","X-Requested-With","_c","settings","_d","timeout","_e","originHeaders","_f","type","_g","fetchOptions","fullPath","getFullPath","FormData","assign","body","JSON","stringify","data","append","fetchFunc","indexOf","method","toUpperCase","credentials","_h","race","delay","Error","cacheDec","result","_j","DefaultEngine"],"mappings":"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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"modelproxy\"), require(\"isomorphic-fetch\"), require(\"url-search-params\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"modelproxy\", \"isomorphic-fetch\", \"url-search-params\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"modelproxy\"] = factory(require(\"modelproxy\"), require(\"isomorphic-fetch\"), require(\"url-search-params\"));\n\telse\n\t\troot[\"modelproxy\"] = factory(root[\"modelproxy\"], root[\"fetch\"], root[\"URLSearchParams\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE__1__, __WEBPACK_EXTERNAL_MODULE__2__, __WEBPACK_EXTERNAL_MODULE__3__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tvar threw = true;\n \t\ttry {\n \t\t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n \t\t\tthrew = false;\n \t\t} finally {\n \t\t\tif(threw) delete installedModules[moduleId];\n \t\t}\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","import { DefaultEngine, cacheDec } from \"modelproxy\";\nimport { IProxyCtx } from \"modelproxy/out/models/proxyctx\";\nimport * as fetch from \"isomorphic-fetch\";\nimport * as URLSearchParams from \"url-search-params\";\n\nconst defaultHeaders = {\n    \"Accept\": \"application/json\",\n    \"Content-Type\": \"application/json\"\n};\n\nexport class FetchEngine<T extends IProxyCtx> extends DefaultEngine {\n\n    /**\n     * 初始化\n     */\n    public init(): void {\n        this.use(this.fetch.bind(this));\n    }\n\n    /**\n     * 发起请求\n     * @param  {IProxyCtx}                     ctx  上下文\n     * @param  {(s?: string) => Promise<any>}  next 下一个中间件\n     * @return {Promise<any>}\n     */\n    public async fetch(ctx: IProxyCtx, next: (s?: string) => Promise<any>) {\n        let formData = new URLSearchParams(),\n            bodyParams = new URLSearchParams(),\n            { executeInfo = {}, instance = {} } = ctx,\n            body, headers: any = { \"X-Requested-With\": \"XMLHttpRequest\" },\n            { timeout = 5000, headers: originHeaders = {}, type = \"\", fetch: fetchOptions = {} } = executeInfo.settings || {},\n            fullPath = this.getFullPath(instance as any, executeInfo);\n\n        if (typeof FormData !== \"undefined\") {\n            formData = new FormData();\n        }\n\n        // 根据type来设置不同的header\n        switch (type) {\n            case \"params\":\n                headers = Object.assign({}, defaultHeaders, headers);\n                body = bodyParams;\n                break;\n            case \"formdata\":\n                body = formData;\n                break;\n            default:\n                headers = Object.assign({}, defaultHeaders, headers);\n                body = JSON.stringify(executeInfo.data || {});\n                break;\n        }\n\n        // 合并headers\n        headers = Object.assign({}, headers || {}, originHeaders);\n\n        // 处理数据\n        for (const key in executeInfo.data) {\n            if (executeInfo.data.hasOwnProperty(key)) {\n                const data = executeInfo.data[key];\n\n                formData.append(key, data);\n                bodyParams.append(key, data);\n            }\n        }\n\n        // 调用解耦请求\n        const fetchFunc: () => Promise<any> = fetch.bind(fetch, fullPath, Object.assign({}, {\n            body: [\"GET\", \"OPTIONS\", \"HEAD\"].indexOf((instance.method as any).toUpperCase()) === -1 ? body : null,\n            credentials: \"same-origin\",\n            headers: headers,\n            method: instance.method as any,\n        }, fetchOptions));\n\n        // 发送请求\n        ctx.result = await Promise.race([\n            this.delay(timeout || 5000).then(() => {\n                throw new Error(`接口请求超时！(${timeout})`);\n            }),\n            cacheDec(fetchFunc, ctx, fullPath)\n        ]);\n\n        await next();\n    }\n}\n","module.exports = __WEBPACK_EXTERNAL_MODULE__1__;","module.exports = __WEBPACK_EXTERNAL_MODULE__2__;","module.exports = __WEBPACK_EXTERNAL_MODULE__3__;"],"sourceRoot":""}
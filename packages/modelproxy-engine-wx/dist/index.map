{"version":3,"sources":["webpack://modelproxy/webpack/universalModuleDefinition","webpack://modelproxy/webpack/bootstrap","webpack://modelproxy/external {\"root\":\"modelproxy\",\"amd\":\"modelproxy\",\"commonjs2\":\"modelproxy\",\"commonjs\":\"modelproxy\"}","webpack://modelproxy/./src/index.ts"],"names":["root","factory","exports","module","require","define","amd","modelproxy","window","__WEBPACK_EXTERNAL_MODULE__0__","e","installedModules","__webpack_require__","moduleId","i","l","threw","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","default","object","property","prototype","hasOwnProperty","p","s","modelproxy_1","FetchEngine","_super","fetchFunc","_this","this","__extends","init","use","fetch","ctx","next","instance","_a","executeInfo","_b","settings","_c","method","_d","header","_e","timeout","fullPath","getFullPath","Error","data","url","_f","Promise","race","delay","then","cacheDec","result","_g","sent","DefaultEngine"],"mappings":"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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"modelproxy\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"modelproxy\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"modelproxy\"] = factory(require(\"modelproxy\"));\n\telse\n\t\troot[\"modelproxy\"] = factory(root[\"modelproxy\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE__0__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tvar threw = true;\n \t\ttry {\n \t\t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n \t\t\tthrew = false;\n \t\t} finally {\n \t\t\tif(threw) delete installedModules[moduleId];\n \t\t}\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","module.exports = __WEBPACK_EXTERNAL_MODULE__0__;","import { DefaultEngine, cacheDec } from \"modelproxy\";\nimport { IProxyCtx } from \"modelproxy/out/models/proxyctx\";\n\n// import { fetchCacheDec } from \"./fetch.cache\";\n// import { fetchDec } from \"./fetch.decorator\";\n\nexport class FetchEngine<T extends IProxyCtx> extends DefaultEngine {\n\n    constructor(private fetchFunc: (s: any) => Promise<any>) {\n        super();\n    }\n\n    /**\n     * 初始化\n     */\n    public init(): void {\n        this.use(this.fetch);\n    }\n\n    /**\n     * 发起请求\n     * @param  {IProxyCtx}                     ctx  上下文\n     * @param  {(s?: string) => Promise<any>}  next 下一个中间件\n     * @return {Promise<any>}\n     */\n    public async fetch(ctx: IProxyCtx, next: (s?: string) => Promise<any>): Promise<any> {\n        const { instance, executeInfo = {}, settings = {} } = ctx;\n        const { method = \"\" } = instance || {};\n        const { header = {}, timeout = 5000 } = settings;\n        const fullPath = this.getFullPath(instance as any, executeInfo);\n\n        if (!this.fetchFunc) {\n            throw new Error(\"fetch function is null.\");\n        }\n\n        const fetchFunc = this.fetchFunc.bind(this.fetchFunc, {\n            data: executeInfo.data,\n            header: header || {},\n            method,\n            url: fullPath,\n        });\n\n        // 发布request请求\n        ctx.result = await Promise.race([\n            this.delay(timeout || 5000).then(() => {\n                throw new Error(`接口请求超时！(${timeout})`);\n            }),\n            cacheDec(fetchFunc, ctx, fullPath),\n        ]);\n\n        await next();\n    }\n}\n"],"sourceRoot":""}
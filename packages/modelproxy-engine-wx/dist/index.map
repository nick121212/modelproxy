{"version":3,"sources":["webpack://modelproxy-engine-wx/webpack/bootstrap","webpack://modelproxy-engine-wx/external {\"root\":\"modelproxy\",\"amd\":\"modelproxy\",\"commonjs2\":\"modelproxy\",\"commonjs\":\"modelproxy\"}","webpack://modelproxy-engine-wx/./src/index.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","threw","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","default","object","property","prototype","hasOwnProperty","p","s","e","require","this","__extends","setPrototypeOf","__proto__","Array","constructor","__awaiter","Promise","u","a","next","throw","done","then","apply","__generator","label","sent","trys","ops","return","iterator","TypeError","pop","length","push","modelproxy_1","FetchEngine","_super","fetchFunc","_this","init","use","fetch","ctx","instance","_a","executeInfo","_b","settings","_c","method","_d","header","_e","timeout","fullPath","getFullPath","Error","data","url","_f","race","delay","cacheDec","result","_g","DefaultEngine"],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tvar threw = true;\n \t\ttry {\n \t\t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n \t\t\tthrew = false;\n \t\t} finally {\n \t\t\tif(threw) delete installedModules[moduleId];\n \t\t}\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","module.exports = require(\"modelproxy\");","import { DefaultEngine, cacheDec } from \"modelproxy\";\nimport { IProxyCtx } from \"modelproxy/out/models/proxyctx\";\n// import { DefaultEngine } from \"modelproxy/out/engines/engine.def\";\n// import { cacheDec } from \"modelproxy/out/engines/engine.cache\";\n\nexport class FetchEngine<T extends IProxyCtx> extends DefaultEngine {\n\n    constructor(private fetchFunc: (s: any) => Promise<any>) {\n        super();\n    }\n\n    /**\n     * 初始化\n     */\n    public init(): void {\n        this.use(this.fetch.bind(this));\n    }\n\n    /**\n     * 发起请求\n     * @param  {IProxyCtx}                     ctx  上下文\n     * @param  {(s?: string) => Promise<any>}  next 下一个中间件\n     * @return {Promise<any>}\n     */\n    public async fetch(ctx: IProxyCtx, next: (s?: string) => Promise<any>): Promise<any> {\n        const { instance, executeInfo = {}, settings = {} } = ctx;\n        const { method = \"\" } = instance || {};\n        const { header = {}, timeout = 5000 } = settings;\n        const fullPath = this.getFullPath(instance as any, executeInfo);\n\n        if (!this.fetchFunc) {\n            throw new Error(\"fetch function is null.\");\n        }\n\n        const fetchFunc = this.fetchFunc.bind(this.fetchFunc, {\n            data: executeInfo.data,\n            header: header || {},\n            method,\n            url: fullPath,\n        });\n\n        // 发布request请求\n        ctx.result = await Promise.race([\n            this.delay(timeout || 5000).then(() => {\n                throw new Error(`接口请求超时！(${timeout})`);\n            }),\n            cacheDec(fetchFunc, ctx, fullPath),\n        ]);\n\n        await next();\n    }\n}\n"],"sourceRoot":""}